# TCL

Все транзакции Oracle подчиняются основным свойства транзакции БД, известной как свойства ACID.

Расшифровывается так:

- Свойство атомарности (Atomicity) выражается в том, что транзакция должна быть выполнена в целом или не выполнена вовсе. **Пример**: транзакция обновляет 100 строк. Если после 20 произошла ошибка, то вся БД откатится до состояния до изменения этих 20 строк.
- Свойство согласованности (Consistency) гарантирует, что по мере выполнения транзакций данные переходят из одного согласованного состояния в другое — транзакция не разрушает взаимной согласованности данных. **Пример:** осуществляется перевод средств с одного счёта на другой. Сбой не должен допустить того, что деньги снимутся с одного счёта, но не добавятся на другой, что приведёт к несогласованным данным.
- Свойство изолированности (Isolation) означает, что конкурирующие за доступ к базе данных транзакции физически обрабатываются последовательно, изолированно друг от друга, но для пользователей это выглядит так, как будто они выполняются параллельно. **Пример:** пользователь, обновляющий таблицу не видит незафиксированных изменений, сделанных одновременно другим пользователем.
- Свойство долговечности (Durability) трактуется следующим образом: если транзакция завершена успешно, то те изменения в данных, которые были ею произведены, не могут быть потеряны ни при каких обстоятельствах (даже в случае последующих ошибок).

Создадим таблицу:

```sql
CREATE table "  trTable" (
"ID"  NUMBER(5,0),
"sum"  NUMBER(10,0),
constraint  "transaction_TABLE_PK" primary key ("ID")
)
```

Добавим данные:

```sql
Insert into trTable values (1, 200000);
Insert into trTable values (2, 100000);
Insert into trTable values (3, 300000);
Insert into trTable values (4, 400000);
```

Сумма денег – 1 000 000.

Перевод денег с номера 4 на номер 1:

```sql
Update trtable set sum = sum - 10000 where id = 4;
Update trtable set sum = sum + 10000 where id = 1;
```

Допустим, мы хотим перевести с номера 4 на номер 1 10000, с номера 2 на номер 3 10000. В первом случае сделаем rollback, во втором commit.

```sql
SET TRANSACTION NAME 'sum_update';
Update trtable set sum = sum - 10000 where id = 4;
Update trtable set sum = sum + 10000 where id = 1;
rollback;
SET TRANSACTION NAME 'sum_update2';
Update trtable set sum = sum - 10000 where id = 2;
Update trtable set sum = sum + 10000 where id = 3;
commit;
```

Как видно по результатам запроса – 1-ый перевод на выполнился, а 2-ой – выполнился.
